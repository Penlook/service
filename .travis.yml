language: go

go:
  - 1.4

services:
  - redis-server
  - mongodb

env:
  - AMQP_URL=amqp://guest:guest@127.0.0.1:5672/ GOMAXPROCS=2

install:
  - go get -v ./...
  - go get github.com/stretchr/testify/assert
  - export PATH=$PATH:$HOME/gopath/bin
  - git submodule update --recursive
  - git submodule status
  - git submodule foreach git checkout master
  - mysql -e 'create database test;'
  - sudo chmod +x ./service.sh
  - git clone https://github.com/penlook/test.git
  - (sudo pip install redis && sudo pip install pyyaml)
  - (cd test; python build.py)
  - chmod +x ./service.sh
  - ./service.sh api build start
  - ./service.sh socket build start
  - ./service.sh storage build start

script:
  - ./service.sh api test
  - ./service.sh socket test
  - ./service.sh storage test